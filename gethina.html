<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grecia Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Menghilangkan scrollbar tapi tetap bisa di-scroll */
    #chatbox::-webkit-scrollbar {
      display: none;
    }
    #chatbox {
      -ms-overflow-style: none;  /* IE and Edge */
      scrollbar-width: none;  /* Firefox */
    }
  </style>
</head>
<body class="bg-gray-800 text-gray-200 font-sans">
  
  <div class="h-screen flex flex-col">
    <main id="chatbox" class="flex-1 overflow-y-auto p-4">
      <div id="welcome-message" class="flex flex-col items-center justify-center h-full">
        <div class="w-16 h-16 bg-gray-700 rounded-full flex items-center justify-center mb-4">
          <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
        </div>
        <h1 class="text-2xl font-semibold">Bagaimana saya bisa membantu Anda hari ini?</h1>
      </div>
    </main>

    <footer class="p-4">
      <div class="max-w-3xl mx-auto">
        <div class="relative flex items-end bg-gray-700 rounded-2xl p-2">
          <textarea 
            id="chat-input" 
            placeholder="Ketik pesan Anda..." 
            rows="1"
            class="w-full bg-transparent resize-none focus:outline-none pl-3 pr-12 text-gray-200"
          ></textarea>
          <button onclick="sendMessage()" class="absolute right-3 bottom-3 text-gray-400 hover:text-white disabled:text-gray-600" disabled>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
            </svg>
          </button>
        </div>
      </div>
    </footer>
  </div>

  <script>
    const chatbox = document.getElementById("chatbox");
    const inputField = document.getElementById("chat-input");
    const sendButton = document.querySelector("footer button");
    const welcomeMessage = document.getElementById("welcome-message");

    // Fungsi untuk menyesuaikan tinggi textarea
    const adjustTextareaHeight = () => {
      inputField.style.height = 'auto'; // Reset tinggi
      inputField.style.height = (inputField.scrollHeight) + 'px'; // Set tinggi baru
    };

    // Event listener untuk input
    inputField.addEventListener("input", () => {
      adjustTextareaHeight();
      // Aktifkan atau nonaktifkan tombol kirim
      if (inputField.value.trim() !== "") {
        sendButton.disabled = false;
        sendButton.classList.remove("text-gray-600");
        sendButton.classList.add("text-gray-400", "hover:text-white");
      } else {
        sendButton.disabled = true;
        sendButton.classList.add("text-gray-600");
        sendButton.classList.remove("text-gray-400", "hover:text-white");
      }
    });
    
    // Event listener untuk tombol Enter
    inputField.addEventListener("keypress", (e) => {
      if (e.key === "Enter" && !e.shiftKey) { // Kirim jika Enter ditekan (tanpa Shift)
        e.preventDefault();
        sendMessage();
      }
    });
    
    // Fungsi untuk menggambar pesan di chatbox
    function renderMessage(message, sender) {
        if (welcomeMessage) {
            welcomeMessage.style.display = 'none'; // Sembunyikan pesan selamat datang
        }
        
        const messageWrapper = document.createElement('div');
        let messageContent = '';

        if (sender === 'user') {
            messageContent = `
                <div class="flex items-start gap-4 max-w-3xl mx-auto py-6">
                    <div class="w-8 h-8 rounded-full bg-blue-500 flex-shrink-0 flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                    </div>
                    <div class="text-gray-200 leading-relaxed">${message}</div>
                </div>
            `;
        } else if (sender === 'bot') {
            messageContent = `
                <div class="bg-gray-700">
                    <div class="flex items-start gap-4 max-w-3xl mx-auto py-6">
                        <div class="w-8 h-8 rounded-full bg-gray-900 flex-shrink-0 flex items-center justify-center">
                           <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
                        </div>
                        <div class="text-gray-200 leading-relaxed">${message}</div>
                    </div>
                </div>
            `;
        } else if (sender === 'error') {
            messageContent = `
                <div class="bg-red-900 bg-opacity-30">
                     <div class="flex items-start gap-4 max-w-3xl mx-auto py-6">
                        <div class="w-8 h-8 rounded-full bg-gray-900 flex-shrink-0 flex items-center justify-center">
                           <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
                        </div>
                        <div class="text-red-400 leading-relaxed">${message}</div>
                    </div>
                </div>
            `;
        }

        messageWrapper.innerHTML = messageContent;
        chatbox.appendChild(messageWrapper);
        chatbox.scrollTop = chatbox.scrollHeight; // Auto scroll
    }

    async function sendMessage() {
      const input = inputField.value.trim();
      if (!input) return;

      // Tampilkan pesan pengguna
      renderMessage(input, 'user');
      
      inputField.value = "";
      sendButton.disabled = true;
      adjustTextareaHeight();

      // Indikator mengetik dari BOT
      const typingIndicator = document.createElement('div');
      typingIndicator.id = 'typing-indicator';
      typingIndicator.innerHTML = `
        <div class="bg-gray-700">
            <div class="flex items-start gap-4 max-w-3xl mx-auto py-6">
                 <div class="w-8 h-8 rounded-full bg-gray-900 flex-shrink-0 flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
                 </div>
                 <div class="flex items-center space-x-1 pt-2">
                    <span class="w-2.5 h-2.5 bg-gray-400 rounded-full animate-pulse"></span>
                    <span class="w-2.5 h-2.5 bg-gray-400 rounded-full animate-pulse [animation-delay:0.2s]"></span>
                    <span class="w-2.5 h-2.5 bg-gray-400 rounded-full animate-pulse [animation-delay:0.4s]"></span>
                 </div>
            </div>
        </div>`;
      chatbox.appendChild(typingIndicator);
      chatbox.scrollTop = chatbox.scrollHeight;

      try {
        // Ganti URL ini dengan URL API Anda
        const response = await fetch("https://825a2a4a1a29.ngrok-free.app/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: input })
        });
        const data = await response.json();

        // Hapus indikator mengetik
        chatbox.removeChild(typingIndicator);

        // Tampilkan balasan dari bot
        renderMessage(data.reply, 'bot');

      } catch (error) {
        console.error("Error:", error);
        if(document.getElementById('typing-indicator')) {
          chatbox.removeChild(document.getElementById('typing-indicator'));
        }
        // Tampilkan pesan error
        renderMessage("⚠️ Gagal terhubung ke server. Silakan coba lagi nanti.", 'error');
      }
    }
  </script>
</body>
</html>
