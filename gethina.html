<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grecia Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Menghilangkan scrollbar tapi tetap bisa di-scroll */
    #chatbox::-webkit-scrollbar {
        display: none;
    }
    #chatbox {
        -ms-overflow-style: none; /* IE and Edge */
        scrollbar-width: none; /* Firefox */
    }
  </style>
</head>
<body class="bg-white font-sans">
  
  <div class="h-screen flex flex-col">
    
    <header class="bg-white p-3 flex items-center shadow-sm z-10 border-b border-gray-200">
      <div class="flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
        <h1 class="ml-3 text-lg font-bold text-gray-800">Grecia Ai</h1>
      </div>
      
      </header>

    <main id="chatbox" class="flex-1 overflow-y-auto p-4 space-y-4 bg-white">
      </main>

    <footer class="bg-white p-2 flex items-center border-t border-gray-200">
      <div class="flex-1 mx-2">
        <input type="text" id="input" placeholder="Aa" class="w-full bg-gray-200 rounded-full px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400">
      </div>

      <button onclick="sendMessage()" class="text-blue-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
        </svg>
      </button>
    </footer>
  </div>

  <script>
    const chatbox = document.getElementById("chatbox");
    const inputField = document.getElementById("input");

    inputField.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        sendMessage();
      }
    });

    async function sendMessage() {
      const input = inputField.value.trim();
      if (!input) return;

      // Gelembung chat PENGGUNA (biru, kanan)
      chatbox.innerHTML += `
        <div class="flex justify-end">
          <div class="bg-blue-500 text-white px-4 py-2 rounded-2xl max-w-xs shadow">
            ${input}
          </div>
        </div>
      `;
      
      inputField.value = "";
      chatbox.scrollTop = chatbox.scrollHeight;

      // Indikator mengetik dari BOT
      const typingIndicator = document.createElement('div');
      typingIndicator.id = 'typing-indicator';
      typingIndicator.innerHTML = `
        <div class="flex justify-start items-end gap-2">
          <img src="logo.png" alt="bot" class="w-8 h-8 rounded-full">
          <div class="bg-gray-200 text-black px-4 py-2 rounded-2xl">
            <div class="flex items-center space-x-1">
              <span class="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></span>
              <span class="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:0.2s]"></span>
              <span class="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:0.4s]"></span>
            </div>
          </div>
        </div>
      `;
      chatbox.appendChild(typingIndicator);
      chatbox.scrollTop = chatbox.scrollHeight;

      try {
        const response = await fetch("https://825a2a4a1a29.ngrok-free.app/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: input })
        });
        const data = await response.json();

        // Hapus indikator mengetik
        chatbox.removeChild(typingIndicator);

        // Gelembung chat BOT (abu-abu, kiri)
        chatbox.innerHTML += `
          <div class="flex justify-start items-end gap-2">
            <img src="logo.png" alt="bot" class="w-8 h-8 rounded-full">
            <div class="bg-gray-200 text-black px-4 py-2 rounded-2xl max-w-xs shadow">
              ${data.reply}
            </div>
          </div>
        `;
      } catch (error) {
        console.error("Error:", error);
        if(document.getElementById('typing-indicator')) {
          chatbox.removeChild(document.getElementById('typing-indicator'));
        }
        chatbox.innerHTML += `
          <div class="flex justify-start items-end gap-2">
            <img src="logo.png" alt="bot" class="w-8 h-8 rounded-full">
            <div class="bg-red-100 text-red-700 px-4 py-2 rounded-2xl max-w-xs shadow">
              ⚠️ Gagal terhubung.
            </div>
          </div>
        `;
      }
      chatbox.scrollTop = chatbox.scrollHeight;
    }
  </script>
</body>
</html>
